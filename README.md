# KaggleRSNATrauma
Repo for RSNA 2023 Abdominal Trauma Detection

## Packages
Main packages:
 * h5py
 * jupyter notebook
 * matplotlib
 * numpy
 * opencv-python
 * pandas
 * pydicom
 * scikit-learn
 * scipy
 * seaborn
 * pytorch

Packages for viewer:
 * PySide2

## Structure of data
 * data - The folder containing the zip file downloaded from Kaggle
   * segmentations - The folder for expert reviewed segmentations
   * test_images - Sample test images from Kaggle. Basically not used.
   * train_images - Train images from Kaggle. Contains .dcm files
 * data_npy - The folder containing the same 3D CT scan volume as data/train_images, in npy format.
 * data_hdf5_cropped - The folder containing cropped and resized CT scans of the patients, in hdf5 format.
 * data_segmentation_hdf_cropped - The segmentation labels of expert reviewed segmentations, cropped and resized
with the same transformation as data_hdf5_cropped
 * total_segmentator_results - The folder containing the results of unprocessed labels generated by Total Segmentator.
 * total_segmentator_hdf_cropped - The folder containing the results of processed labels generated by Total Segmentator, cropped, resized and converted to hdf5.
 * stage1_organ_segmentator - The folder containing the results of models trained from Stage 1
 * stage1_organ_segmentator_eval - The folder containing the evaluation metrics of models trained from Stage 1, compared to ground truth expert reviewed labels (if available) or generate pseudo labels from Total Segmentator.

## Scripts

### Generation of cropped and resized CTs, and expert segmentations
 * convert_to_hdf_cropped.py

### Generation of total segmentator segmentations
 * total_segmentator_inference.py (use total segmentator to generate)
 * convert_total_segmentator_to_cropped_hdf.py (convert and align labels to CTs)

### Stage1
 * fold[1..3]_stage1.sh (train models, and eval segmentation)
 * manager_stage1_results.py (run after all folds[1..3] are done)

The Python scripts used for training are training_ROI_preds.py (invoked in .sh files), stage1_organ_segmentation.py and stage1_organ_segmentation_validate.py